<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Minesweeper-klipse</title>
<link rel="stylesheet" type="text/css" href="https://storage.googleapis.com/app.klipse.tech/css/codemirror.css">
<script>
    window.klipse_settings = {
        selector: '.language-klipse',
        selector_reagent: '.language-reagent',
    };
</script>
</head>
<body>
<h1><center>Minesweeper-klipse</center></h1>
<h2>
<pre><code class="language-klipse">
(require '[reagent.core :as r])

(def board-width 12)
(def board-height 12)
(def num-mines 18)

(def rand-positions
  (shuffle
   (for [i (range board-width)
         j (range board-height)]
     [i j])))

(def mines
  (loop [squares (repeat num-mines 1)]
    (if (= (count squares) (* board-width board-height))
      squares
      (recur (conj squares 0)))))

(def minefield
  (into {}
      (map vector
           rand-positions
           mines)))

(defn rect-cell [x y]
  [:rect.cell
   {:x (+ 0.05 x) :width 0.9
    :y (+ 0.05 y) :height 0.9
    :fill "white"
    :stroke-width 0.025
    :stroke "black"}])

(defn mine [i j]
  [:g {:stroke "darkred"
       :stroke-width 0.4
       :stroke-linecap "round"
       :transform
       (str "translate(" (+ 0.5 i) "," (+ 0.5 j) ") "
            "scale(0.3)")}
   [:line {:x1 -1 :y1 -1 :x2 1 :y2 1}]
   [:line {:x1 1 :y1 -1 :x2 -1 :y2 1}]])

(defn render-board []
  (into
   [:svg.board
    {:view-box (str "0 0 " board-width " " board-height)
     :shape-rendering "auto"
     :style {:max-height "500px"}}]
   (for [i (range board-width)
         j (range board-height)]
     [:g
      [rect-cell i j]
      (if (= 1 (minefield [i j]))
          [mine i j])])))
</code></pre>

<pre><code class="language-reagent">
[render-board]
</code></pre>
</h2>
<script src="https://storage.googleapis.com/app.klipse.tech/plugin/js/klipse_plugin.js"></script>
</body>
</html>
